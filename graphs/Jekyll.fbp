# This graph contains the main control flow of the Jekyll site-building process

# The source inport is where the graph finds the Jekyll site sources
EXPORT=SOURCE.IN:SOURCE

# The destination inport is where the graph creates the site
EXPORT=DESTINATION.IN:DESTINATION

# The generated outport tells paths of all generated files
EXPORT=GENERATED.OUT:GENERATED

# The errors outport outputs any errors
EXPORT=ERRORS.OUT:ERRORS

Source(Split) OUT -> DIRECTORY GetConfig(jekyll/GetConfig)
GetConfig() CONFIG -> IN SplitConfig(Split)

Source() OUT -> IN FindFiles(Merge)
FindFiles() OUT -> DIRECTORY LoadDocuments(jekyll/LoadDocuments)
LoadDocuments() SUBDIRECTORY -> IN FindFiles()

'text' -> ROUTES DetermineType(jekyll/MimeRouter)
LoadDocuments() DOCUMENT -> IN DetermineType()

# Text files parsed for Front Matter
DetermineType() OUT -> IN GroupDocs(jekyll/GroupDocuments)
GroupDocs() LAYOUT -> LAYOUTS Build(jekyll/BuildDocuments)
GroupDocs() INCLUDE -> INCLUDES Build()

# Check content format for conversions
'text/x-markdown' -> ROUTES ContentType(jekyll/DocumentMimeRouter)
# Markdown conversion
ContentType() OUT -> IN ConvertMarkdown(jekyll/ConvertMarkdown)
ConvertMarkdown() OUT -> IN Build()
# Other content formats (CSS, HTML, JavaScript, ...)
ContentType() MISSED -> IN Build()

GroupDocs() POST -> IN DropPosts(Drop)
GroupDocs() STATIC -> IN ContentType()
SplitConfig() OUT -> CONFIG Build()

Source() OUT -> SOURCE SaveBuilt(jekyll/SaveFile)
Destination(Split) OUT -> DESTINATION SaveBuilt()
Build() GENERATED -> IN SaveBuilt()
SaveBuilt() OUT -> IN Generated(Merge)
SaveBuilt() ERROR -> IN Errors(Merge)

# Binary files that will be copied as-is
'/_' -> REGEXP FilterDirs(FilterPacket)
DetermineType() MISSED -> IN FilterDirs()
FilterDirs() OUT -> IN DropDir(Drop)
Source() OUT -> SOURCE CopyFiles(jekyll/CopyFile)
Destination() OUT -> DESTINATION CopyFiles()
FilterDirs() MISSED -> IN CopyFiles()
CopyFiles() OUT -> IN Generated()
